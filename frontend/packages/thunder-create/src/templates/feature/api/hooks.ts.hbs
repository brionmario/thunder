/**
 * Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com).
 *
 * WSO2 LLC. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import {useQuery, useMutation, useQueryClient, UseQueryResult, UseMutationResult} from '@tanstack/react-query';
import {useAsgardeo} from '@asgardeo/react';
import {useConfig} from '@/hooks';
import {{{pascalCase featureName}}QueryKeys} from './queryKeys.js';
import type {{{pascalCase featureName}}, Create{{pascalCase featureName}}Request, Update{{pascalCase featureName}}Request} from '../models/types.js';

/**
 * Custom hook to fetch {{featureName}} list.
 */
export default function useGet{{pascalCase featureName}}List(): UseQueryResult<{{pascalCase featureName}}[], Error> {
  const {config} = useConfig();
  const {httpRequest} = useAsgardeo();

  return useQuery({
    queryKey: [{{pascalCase featureName}}QueryKeys.{{constantCase featureName}}_LIST],
    queryFn: async (): Promise<{{pascalCase featureName}}[]> => {
      const response = await httpRequest({
        method: 'GET',
        url: `${config.serverHost}/{{kebabCase featureName}}`,
      });

      return response.data;
    },
  });
}

/**
 * Custom hook to fetch a single {{featureName}} by ID.
 */
export function useGet{{pascalCase featureName}}(id: string): UseQueryResult<{{pascalCase featureName}}, Error> {
  const {config} = useConfig();
  const {httpRequest} = useAsgardeo();

  return useQuery({
    queryKey: [{{pascalCase featureName}}QueryKeys.{{constantCase featureName}}_DETAIL, id],
    queryFn: async (): Promise<{{pascalCase featureName}}> => {
      const response = await httpRequest({
        method: 'GET',
        url: `${config.serverHost}/{{kebabCase featureName}}/${id}`,
      });

      return response.data;
    },
    enabled: !!id,
  });
}

/**
 * Custom hook to create a new {{featureName}}.
 */
export function useCreate{{pascalCase featureName}}(): UseMutationResult<{{pascalCase featureName}}, Error, Create{{pascalCase featureName}}Request> {
  const {config} = useConfig();
  const {httpRequest} = useAsgardeo();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async ({{camelCase featureName}}Data: Create{{pascalCase featureName}}Request): Promise<{{pascalCase featureName}}> => {
      const response = await httpRequest({
        method: 'POST',
        url: `${config.serverHost}/{{kebabCase featureName}}`,
        data: {{camelCase featureName}}Data,
      });

      return response.data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({queryKey: [{{pascalCase featureName}}QueryKeys.{{constantCase featureName}}_LIST]});
    },
  });
}

/**
 * Custom hook to update a {{featureName}}.
 */
export function useUpdate{{pascalCase featureName}}(): UseMutationResult<{{pascalCase featureName}}, Error, {id: string; data: Update{{pascalCase featureName}}Request}> {
  const {config} = useConfig();
  const {httpRequest} = useAsgardeo();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async ({id, data}: {id: string; data: Update{{pascalCase featureName}}Request}): Promise<{{pascalCase featureName}}> => {
      const response = await httpRequest({
        method: 'PUT',
        url: `${config.serverHost}/{{kebabCase featureName}}/${id}`,
        data,
      });

      return response.data;
    },
    onSuccess: (data, {id}) => {
      queryClient.invalidateQueries({queryKey: [{{pascalCase featureName}}QueryKeys.{{constantCase featureName}}_LIST]});
      queryClient.invalidateQueries({queryKey: [{{pascalCase featureName}}QueryKeys.{{constantCase featureName}}_DETAIL, id]});
    },
  });
}

/**
 * Custom hook to delete a {{featureName}}.
 */
export function useDelete{{pascalCase featureName}}(): UseMutationResult<void, Error, string> {
  const {config} = useConfig();
  const {httpRequest} = useAsgardeo();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (id: string): Promise<void> => {
      await httpRequest({
        method: 'DELETE',
        url: `${config.serverHost}/{{kebabCase featureName}}/${id}`,
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({queryKey: [{{pascalCase featureName}}QueryKeys.{{constantCase featureName}}_LIST]});
    },
  });
}
